name: Telegram Scheduled Posts

on:
  schedule:
    # UTC 기준
    # KST 09:00 = UTC 00:00 (평일)
    - cron: "0 0 * * 1-5"
    # KST 15:30 = UTC 06:30 (평일)
    - cron: "30 6 * * 1-5"
  workflow_dispatch:
    inputs:
      post_event:
        description: "AM or PM"
        required: true
        default: "AM"

permissions:
  contents: write

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - run: pip install requests holidays
      - name: Post to Telegram
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          POST_EVENT: ${{ github.event_name == 'workflow_dispatch' && inputs.post_event || (github.event.schedule == '0 0 * * 1-5' && 'AM') || 'PM' }}
        run: python post.py
