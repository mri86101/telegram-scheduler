name: Telegram Scheduled Posts

on:
  schedule:
    # KST 08:00 = UTC 23:00 (전날) -> 월~금 아침 8시를 맞추려면 UTC는 일~목(0-4)
    - cron: "0 23 * * 0-4"
    # KST 15:00 = UTC 06:00 (평일)
    - cron: "0 6 * * 1-5"
  workflow_dispatch:
    inputs:
      post_event:
        description: "AM or PM"
        required: true
        default: "AM"

permissions:
  contents: write

concurrency:
  group: telegram-post
  cancel-in-progress: true

jobs:
  post:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    env:
      TZ: Asia/Seoul
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install requests holidays

      - name: Debug current time
        run: date

      - name: Post to Telegram
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          POST_EVENT: ${{ github.event_name == 'workflow_dispatch' && inputs.post_event || (github.event.schedule == '0 23 * * 0-4' && 'AM') || 'PM' }}
        run: python post.py
